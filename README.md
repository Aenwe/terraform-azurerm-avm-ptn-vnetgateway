# terraform-azurerm-vnet-gateway
This module is designed to deploy an Azure Virtual Network Gateway and several auxillary resources associated to it. 

## Features 
- Virtual Network Gateway: 
    - VPN Gateway or ExpressRoute Gateway. 
    - Active-Active or Single.
    - Deployment of `GatewaySubnet`.
- Route Table 
    - Optional deployment of Route Table on the Gateway Subnet.
- Local Network Gateway:
    - Optional deployment of `n` Local Network Gateways.
    - Optional deployment of `n` Virtual Network Gateway Connections for Local Network Gateways. 
- ExpressRoute Circuit:
    - Configure peering on `n` pre-provisioned ExpressRoute Circuits.
    - Optional deployment of `n` Virtual Network Gateway Connections for ExpressRoute Circuits.

## Example 
```hcl
resource "azurerm_resource_group" "rg" {
  location = "uksouth"
  name     = "rg-connectivity-uksouth-prod"
}

resource "azurerm_virtual_network" "vnet" {
  address_space       = ["10.0.0.0/16"]
  location            = azurerm_resource_group.rg.location
  name                = "vnet-uksouth-prod"
  resource_group_name = azurerm_resource_group.rg.name
}

module "vgw" {
  source  = "Azure/vnet-gateway/azure"
  version = "<version>" # change this to your desired version, https://www.terraform.io/language/expressions/version-constraints

  location              = "uksouth"
  name                  = "vgw-uksouth-prod"
  resource_group_name   = azurerm_resource_group.rg.name
  sku                   = "VpnGw1"
  subnet_address_prefix = "10.0.0.1/24"
  type                  = "Vpn"
  virtual_network_name  = azurerm_virtual_network.vnet.name
}
```
# Contributing 
1. Write Terraform code in a new branch.
2. Run `docker run --rm -v ${pwd}:/src -w /src mcr.microsoft.com/azterraform:latest make pre-commit` to format the code.
3. Run `docker run --rm -v $(pwd):/src -w /src mcr.microsoft.com/azterraform:latest make pr-check` to run the check locally.
4. Create a pull request for the main branch.
    * CI pr-check will be executed automatically.
    * Once pr-check was passed, with manually approval, the e2e test and version upgrade test would be executed.
5. Merge pull request.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                      | Version       |
|---------------------------------------------------------------------------|---------------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3        |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm)       | >= 3.1, < 4.0 |

## Providers

| Name                                                          | Version       |
|---------------------------------------------------------------|---------------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | >= 3.1, < 4.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                                 | Type     |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| [azurerm_express_route_circuit_peering.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/express_route_circuit_peering)           | resource |
| [azurerm_local_network_gateway.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/local_network_gateway)                           | resource |
| [azurerm_public_ip.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/public_ip)                                                   | resource |
| [azurerm_route_table.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/route_table)                                               | resource |
| [azurerm_subnet.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/subnet)                                                         | resource |
| [azurerm_subnet_route_table_association.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/subnet_route_table_association)         | resource |
| [azurerm_virtual_network_gateway.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_network_gateway)                       | resource |
| [azurerm_virtual_network_gateway_connection.vgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_network_gateway_connection) | resource |

## Inputs

| Name                                                                                                                                                                    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Default        | Required |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|:--------:|
| <a name="input_default_tags"></a> [default\_tags](#input\_default\_tags)                                                                                                | Tags to apply to all resources.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`           |    no    |
| <a name="input_edge_zone"></a> [edge\_zone](#input\_edge\_zone)                                                                                                         | The availability zone of the Virtual Network Gateway. Only supported for AZ SKUs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null`         |    no    |
| <a name="input_express_route_circuits"></a> [express\_route\_circuits](#input\_express\_route\_circuits)                                                                | Map of Virtual Network Gateway Connections and Peering Configurations to create for existing ExpressRoute circuits.<br><br>- `express_route_circuit_id` - (Required) The ID of the ExpressRoute circuit.<br><br>- `connection_config` - (Optional) a `connection_config` block as defined below. Used to configure the Virtual Network Gateway Connection between the ExpressRoute Circuit and the Virtual Network Gateway.<br>  - `authorization_key` - (Optional) The authorization key for the ExpressRoute Circuit.<br>  - `express_route_gateway_bypass` - (Optional) Whether to bypass the ExpressRoute Gateway for data forwarding. <br>  - `name` - (Optional) The name of the Virtual Network Gateway Connection.<br>  - `routing_weight` - (Optional) The weight added to routes learned from this Virtual Network Gateway Connection. Defaults to 10.<br>  - `shared_key` - (Optional) The shared key for the Virtual Network Gateway Connection.<br>  - `tags` - (Optional) A mapping of tags to assign to the resource.<br><br>- `peering_config` - (Optional) a `peering_config` block as defined below. Used to configure the ExpressRoute Circuit Peering.<br>  - `peering_type` - (Required) The type of the peering. Possible values are AzurePrivatePeering, AzurePublicPeering or MicrosoftPeering.<br>  - `vlan_id` - (Required) The VLAN ID for the peering.<br>  - `ipv4_enabled` - (Optional) Whether IPv4 is enabled on the peering. Defaults to true.<br>  - `peer_asn` - (Optional) The peer ASN.<br>  - `primary_peer_address_prefix` - (Optional) The primary address prefix.<br>  - `secondary_peer_address_prefix` - (Optional) The secondary address prefix.<br>  - `shared_key` - (Optional) The shared key for the peering.<br>  - `route_filter_id` - (Optional) The ID of the route filter to apply to the peering.<br>  - `microsoft_peering_config` - (Optional) a `microsoft_peering_config` block as defined below. Used to configure the Microsoft Peering.<br>    - `advertised_communities` - (Optional) The list of communities to advertise to the Microsoft Peering.<br>    - `advertised_public_prefixes` - (Required) The list of public prefixes to advertise to the Microsoft Peering.<br>    - `customer_asn` - (Optional) The customer ASN.<br>    - `routing_registry_name` - (Optional) The routing registry name.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <pre>map(object({<br>    express_route_circuit_id = string<br>    connection_config = optional(object({<br>      authorization_key            = optional(string, null)<br>      express_route_gateway_bypass = optional(bool, null)<br>      name                         = optional(string, null)<br>      routing_weight               = optional(number, null)<br>      shared_key                   = optional(string, null)<br>      tags                         = optional(map(string), {})<br>    }), null)<br>    peering_config = optional(object({<br>      peering_type                  = string<br>      vlan_id                       = number<br>      ipv4_enabled                  = optional(bool, true)<br>      peer_asn                      = optional(number, null)<br>      primary_peer_address_prefix   = optional(number, null)<br>      secondary_peer_address_prefix = optional(string, null)<br>      shared_key                    = optional(string, null)<br>      route_filter_id               = optional(string, null)<br>      microsoft_peering_config = optional(object({<br>        advertised_public_prefixes = list(string)<br>        advertised_communities     = optional(list(string), null)<br>        customer_asn               = optional(number, null)<br>        routing_registry_name      = optional(string, null)<br>      }), null)<br>    }), null)<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `{}`           |    no    |
| <a name="input_ip_configurations"></a> [ip\_configurations](#input\_ip\_configurations)                                                                                 | Map of IP Configurations to create for the Virtual Network Gateway.<br><br>- `ip_configuration_name` - (Optional) The name of the IP Configuration.<br>- `apipa_addresses` - (Optional) The list of APPIPA addresses.<br>- `private_ip_address_allocation` - (Optional) The private IP allocation method. Possible values are Static or Dynamic. Defaults to Dynamic.<br>- `public_ip` - (Optional) a `public_ip` block as defined below. Used to configure the Public IP Address for the IP Configuration.<br>  - `name` - (Optional) The name of the Public IP Address.<br>  - `allocation_method` - (Optional) The allocation method of the Public IP Address. Possible values are Static or Dynamic. Defaults to Dynamic.<br>  - `sku` - (Optional) The SKU of the Public IP Address. Possible values are Basic or Standard. Defaults to Basic.<br>  - `tags` - (Optional) A mapping of tags to assign to the resource.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <pre>map(object({<br>    ip_configuration_name         = optional(string, null)<br>    apipa_addresses               = optional(list(string), null)<br>    private_ip_address_allocation = optional(string, "Dynamic")<br>    public_ip = optional(object({<br>      name              = optional(string, null)<br>      allocation_method = optional(string, "Dynamic")<br>      sku               = optional(string, "Basic")<br>      tags              = optional(map(string), {})<br>    }), {})<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `{}`           |    no    |
| <a name="input_local_network_gateways"></a> [local\_network\_gateways](#input\_local\_network\_gateways)                                                                | Map of Local Network Gateways and Virtual Network Gateway Connections to create for the Virtual Network Gateway.<br><br>- `name` - (Optional) The name of the Local Network Gateway.<br>- `address_space` - (Optional) The list of address spaces for the Local Network Gateway.<br>- `gateway_fqdn` - (Optional) The gateway FQDN for the Local Network Gateway.<br>- `gateway_address` - (Optional) The gateway IP address for the Local Network Gateway.<br>- `tags` - (Optional) A mapping of tags to assign to the resource.<br>- `bgp_settings` - (Optional) a `bgp_settings` block as defined below. Used to configure the BGP settings for the Local Network Gateway.<br>  - `asn` - (Required) The ASN of the Local Network Gateway.<br>  - `bgp_peering_address` - (Required) The BGP peering address of the Local Network Gateway.<br>  - `peer_weight` - (Optional) The weight added to routes learned from this BGP speaker.<br><br>- `connection_config` - (Optional) a `connection_config` block as defined below. Used to configure the Virtual Network Gateway Connection for the Local Network Gateway.<br>  - `name` - (Optional) The name of the Virtual Network Gateway Connection.<br>  - `type` - (Required) The type of Virtual Network Gateway Connection. Possible values are IPsec or Vnet2Vnet.<br>  - `connection_mode` - (Optional) The connection mode.<br>  - `connection_protocol` - (Optional) The connection protocol. Possible values are IKEv2 or IKEv1.<br>  - `dpd_timeout_seconds` - (Optional) The dead peer detection timeout in seconds.<br>  - `egress_nat_rule_ids` - (Optional) The list of egress NAT rule IDs.<br>  - `enable_bgp` - (Optional) Whether or not BGP is enabled for this Virtual Network Gateway Connection.<br>  - `ingress_nat_rule_ids` - (Optional) The list of ingress NAT rule IDs.<br>  - `local_azure_ip_address_enabled` - (Optional) Whether or not the local Azure IP address is enabled.<br>  - `peer_virtual_network_gateway_id` - (Optional) The ID of the peer Virtual Network Gateway.<br>  - `routing_weight` - (Optional) The routing weight.<br>  - `shared_key` - (Optional) The shared key.<br>  - `tags` - (Optional) A mapping of tags to assign to the resource.<br>  - `use_policy_based_traffic_selectors` - (Optional) Whether or not to use policy based traffic selectors.<br>  - `custom_bgp_addresses` - (Optional) a `custom_bgp_addresses` block as defined below. Used to configure the custom BGP addresses for the Virtual Network Gateway Connection.<br>    - `primary` - (Required) The primary custom BGP address.<br>    - `secondary` - (Required) The secondary custom BGP address.<br>  - `ipsec_policy` - (Optional) a `ipsec_policy` block as defined below. Used to configure the IPsec policy for the Virtual Network Gateway Connection.<br>    - `dh_group` - (Required) The DH Group used in IKE Phase 1 for initial SA.<br>    - `ike_encryption` - (Required) The IKE encryption algorithm (IKE phase 2).<br>    - `ike_integrity` - (Required) The IKE integrity algorithm (IKE phase 2).<br>    - `ipsec_encryption` - (Required) The IPSec encryption algorithm (IKE phase 1).<br>    - `ipsec_integrity` - (Required) The IPSec integrity algorithm (IKE phase 1).<br>    - `pfs_group` - (Required) The Pfs Group used in IKE Phase 2 for new child SA.<br>    - `sa_datasize` - (Optional) The IPSec Security Association (also called Quick Mode or Phase 2 SA) data size specified in KB for a policy.<br>    - `sa_lifetime` - (Optional) The IPSec Security Association (also called Quick Mode or Phase 2 SA) lifetime specified in seconds for a policy.<br>  - `traffic_selector_policy` - (Optional) a `traffic_selector_policy` block as defined below. Used to configure the traffic selector policy for the Virtual Network Gateway Connection.<br>    - `local_address_prefixes` - (Required) The list of local address prefixes.<br>    - `remote_address_prefixes` - (Required) The list of remote address prefixes. | <pre>map(object({<br>    name            = optional(string, null)<br>    address_space   = optional(list(string), null)<br>    gateway_fqdn    = optional(string, null)<br>    gateway_address = optional(string, null)<br>    tags            = optional(map(string), {})<br>    bgp_settings = optional(object({<br>      asn                 = number<br>      bgp_peering_address = string<br>      peer_weight         = optional(number, null)<br>    }), null)<br>    connection_config = optional(object({<br>      name                               = optional(string, null)<br>      type                               = string<br>      connection_mode                    = optional(string, null)<br>      connection_protocol                = optional(string, null)<br>      dpd_timeout_seconds                = optional(number, null)<br>      egress_nat_rule_ids                = optional(list(string), null)<br>      enable_bgp                         = optional(bool, null)<br>      ingress_nat_rule_ids               = optional(list(string), null)<br>      local_azure_ip_address_enabled     = optional(bool, null)<br>      peer_virtual_network_gateway_id    = optional(string, null)<br>      routing_weight                     = optional(number, null)<br>      shared_key                         = optional(string, null)<br>      tags                               = optional(map(string), null)<br>      use_policy_based_traffic_selectors = optional(bool, null)<br>      custom_bgp_addresses = optional(object({<br>        primary   = string<br>        secondary = string<br>      }), null)<br>      ipsec_policy = optional(object({<br>        dh_group         = string<br>        ike_encryption   = string<br>        ike_integrity    = string<br>        ipsec_encryption = string<br>        ipsec_integrity  = string<br>        pfs_group        = string<br>        sa_datasize      = optional(number, null)<br>        sa_lifetime      = optional(number, null)<br>      }), null)<br>      traffic_selector_policy = optional(list(<br>        object({<br>          local_address_prefixes  = list(string)<br>          remote_address_prefixes = list(string)<br>        })<br>      ), null)<br>    }), null)<br>  }))</pre> | `{}`           |    no    |
| <a name="input_location"></a> [location](#input\_location)                                                                                                              | The Azure region where the resources will be deployed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_name"></a> [name](#input\_name)                                                                                                                          | The name of the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)                                                                         | The name of the resource group.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_route_table_bgp_route_propagation_enabled"></a> [route\_table\_bgp\_route\_propagation\_enabled](#input\_route\_table\_bgp\_route\_propagation\_enabled) | Whether or not to enable BGP route propagation on the Route Table.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `true`         |    no    |
| <a name="input_route_table_creation_enabled"></a> [route\_table\_creation\_enabled](#input\_route\_table\_creation\_enabled)                                            | Whether or not to create a Route Table associated with the Virtual Network Gateway Subnet.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `false`        |    no    |
| <a name="input_route_table_name"></a> [route\_table\_name](#input\_route\_table\_name)                                                                                  | Name of the Route Table associated with Virtual Network Gateway Subnet.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null`         |    no    |
| <a name="input_route_table_tags"></a> [route\_table\_tags](#input\_route\_table\_tags)                                                                                  | Tags for the Route Table.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`           |    no    |
| <a name="input_sku"></a> [sku](#input\_sku)                                                                                                                             | The SKU (size) of the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_subnet_address_prefix"></a> [subnet\_address\_prefix](#input\_subnet\_address\_prefix)                                                                   | The address prefix for the gateway subnet.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_tags"></a> [tags](#input\_tags)                                                                                                                          | Tags to apply to the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`           |    no    |
| <a name="input_tracing_tags_enabled"></a> [tracing\_tags\_enabled](#input\_tracing\_tags\_enabled)                                                                      | Whether enable tracing tags that generated by BridgeCrew Yor.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `false`        |    no    |
| <a name="input_tracing_tags_prefix"></a> [tracing\_tags\_prefix](#input\_tracing\_tags\_prefix)                                                                         | Default prefix for generated tracing tags                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `"avm_"`       |    no    |
| <a name="input_type"></a> [type](#input\_type)                                                                                                                          | The type of the Virtual Network Gateway, ExpressRoute or VPN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_virtual_network_name"></a> [virtual\_network\_name](#input\_virtual\_network\_name)                                                                      | The name of the Virtual Network.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a            |   yes    |
| <a name="input_vpn_active_active_enabled"></a> [vpn\_active\_active\_enabled](#input\_vpn\_active\_active\_enabled)                                                     | Enable active-active mode for the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `false`        |    no    |
| <a name="input_vpn_bgp_enabled"></a> [vpn\_bgp\_enabled](#input\_vpn\_bgp\_enabled)                                                                                     | Enable BGP for the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `false`        |    no    |
| <a name="input_vpn_bgp_settings"></a> [vpn\_bgp\_settings](#input\_vpn\_bgp\_settings)                                                                                  | BGP settings for the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <pre>object({<br>    asn         = optional(number, null)<br>    peer_weight = optional(number, null)<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`         |    no    |
| <a name="input_vpn_generation"></a> [vpn\_generation](#input\_vpn\_generation)                                                                                          | value for the Generation for the Gateway, Valid values are 'Generation1', 'Generation2'. Options differ depending on SKU.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `null`         |    no    |
| <a name="input_vpn_point_to_site"></a> [vpn\_point\_to\_site](#input\_vpn\_point\_to\_site)                                                                             | Point to site configuration for the virtual network gateway.<br><br>- `address_space` - (Required) Address space for the virtual network gateway.<br>- `aad_tenant` - (Optional) The AAD tenant to use for authentication.<br>- `aad_audience` - (Optional) The AAD audience to use for authentication.<br>- `aad_issuer` - (Optional) The AAD issuer to use for authentication.<br>- `radius_server_address` - (Optional) The address of the radius server.<br>- `radius_server_secret` - (Optional) The secret of the radius server.<br>- `root_certificate` - (Optional) The root certificate of the virtual network gateway.<br>  - `name` - (Required) The name of the root certificate.<br>  - `public_cert_data` - (Required) The public certificate data.<br>- `revoked_certificate` - (Optional) The revoked certificate of the virtual network gateway.<br>  - `name` - (Required) The name of the revoked certificate.<br>  - `thumbprint` - (Required) The thumbprint of the revoked certificate.<br>- `vpn_client_protocols` - (Optional) The VPN client protocols.<br>- `vpn_auth_types` - (Optional) The VPN authentication types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>object({<br>    address_space         = list(string)<br>    aad_tenant            = optional(string, null)<br>    aad_audience          = optional(string, null)<br>    aad_issuer            = optional(string, null)<br>    radius_server_address = optional(string, null)<br>    radius_server_secret  = optional(string, null)<br>    root_certificate = optional(map(object({<br>      name             = string<br>      public_cert_data = string<br>    })), {})<br>    revoked_certificate = optional(map(object({<br>      name       = string<br>      thumbprint = string<br>    })), {})<br>    vpn_client_protocols = optional(list(string), null)<br>    vpn_auth_types       = optional(list(string), null)<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `null`         |    no    |
| <a name="input_vpn_private_ip_address_enabled"></a> [vpn\_private\_ip\_address\_enabled](#input\_vpn\_private\_ip\_address\_enabled)                                    | Enable private IP address for the Virtual Network Gateway for Virtual Network Gateway Connections. Only supported for AZ SKUs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null`         |    no    |
| <a name="input_vpn_type"></a> [vpn\_type](#input\_vpn\_type)                                                                                                            | The VPN type of the Virtual Network Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `"RouteBased"` |    no    |

## Outputs

| Name                                                                                                                                                | Description                                                                         |
|-----------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| <a name="output_local_network_gateways"></a> [local\_network\_gateways](#output\_local\_network\_gateways)                                          | A curated output of the Local Network Gateways created by this module.              |
| <a name="output_public_ip_addresses"></a> [public\_ip\_addresses](#output\_public\_ip\_addresses)                                                   | A curated output of the Public IP Addresses created by this module.                 |
| <a name="output_route_table"></a> [route\_table](#output\_route\_table)                                                                             | A curated output of the Route Table created by this module.                         |
| <a name="output_virtual_network_gateway"></a> [virtual\_network\_gateway](#output\_virtual\_network\_gateway)                                       | A curated output of the Virtual Network Gateway created by this module.             |
| <a name="output_virtual_network_gateway_connections"></a> [virtual\_network\_gateway\_connections](#output\_virtual\_network\_gateway\_connections) | A curated output of the Virtual Network Gateway Connections created by this module. |
<!-- END_TF_DOCS -->
